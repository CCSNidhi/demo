name: Build and Release

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Check commit message and set version bump
      run: |
        commitMessage=$(git log -1 --pretty=format:%B)
        if [[ $commitMessage =~ patch ]]; then
          echo "bump=patch" >> $GITHUB_ENV
        elif [[ $commitMessage =~ minor ]]; then
          echo "bump=minor" >> $GITHUB_ENV
        elif [[ $commitMessage =~ major ]]; then
          echo "bump=major" >> $GITHUB_ENV
        else
          echo "bump=none" >> $GITHUB_ENV
        fi
    - name: Set current version in the VERSION file
      run: echo "1.0.0" > VERSION
    - name: Generate new version and update VERSION file
      run: |
        bump=$bump
        if [[ $bump == "patch" ]]; then
          newVersion=$(semver bump patch $(cat VERSION))
        elif [[ $bump == "minor" ]]; then
          newVersion=$(semver bump minor $(cat VERSION))
        elif [[ $bump == "major" ]]; then
          newVersion=$(semver bump major $(cat VERSION))
        else
          newVersion=$(cat VERSION)
        fi
        echo $newVersion > VERSION
        echo "newVersion=$newVersion" >> $GITHUB_ENV
    - name: Build the project
      run: 
       dotnet build MauiApp_version/MauiApp_version.csproj -c Release
    - name: Build
      run: |
        dotnet publish MauiApp_version.csproj -c Release -f:net7.0-windows10.0.19041.0 /p:GenerateAppxPackageOnBuild=true /p
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v2
      with:
        name: maui-app-msix
        path: |
          demo/MauiApp_version/MauiApp_version/bin/Release/




        




